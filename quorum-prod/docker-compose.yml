version: '3'
services:
  eth-stats:
    image: quay.io/amis/ethstats:latest
    ports:
      - '3000:3000'
    environment:
      - WS_SECRET=bb98a0b6442386d0cdf8a31b267892c1
    restart: always
    networks:
      app_net:
        ipv4_address: 172.16.239.9
  validator-0:
    hostname: validator-0
    image: 257258793156.dkr.ecr.ap-northeast-1.amazonaws.com/quorum:v2.7.0_validator_20200904
    ports:
      - '30303:30303'
      - '8545:8545'
    environment:
      - PRIVATE_CONFIG=ignore
    entrypoint:
      - /bin/sh
      - -c
      - |
        mkdir -p /eth/geth
        echo '{"config":{"chainId":1500002,"homesteadBlock":1,"eip150Block":2,"eip150Hash":"0x0000000000000000000000000000000000000000000000000000000000000000","eip155Block":3,"eip158Block":3,"byzantiumBlock":3,"istanbul":{"epoch":30000,"policy":0},"isQuorum":true},"nonce":"0x0","timestamp":"0x5b30a79f","extraData":"0x0000000000000000000000000000000000000000000000000000000000000000f89af8549455718e72e048375d824233e8139a7df791c9922c949dd59c486f1a307c92946ad373f28f10b1d3623294301c2945de770f93700d0b4371d59d1a81d2fdf5943a8b94e5774baa7f9b6c9ef28859dc8fd7577c5bb8410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0","gasLimit":"0x2faf0800","difficulty":"0x1","mixHash":"0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365","coinbase":"0x0000000000000000000000000000000000000000","constantinopleBlock":0,"petersburgBlock":0,"istanbulBlock":0,"alloc":{"585805c23915d6feae27fb33c6c120833ff11a72":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"},"622a8cde6464cf35de07a12963123224f28e909f":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"},"67edbafd6b3edd79cac703a383e9de80c2f92d32":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"},"95b36d653a9adb4056e72d2a0c95904690720675":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"}},"number":"0x0","gasUsed":"0x0","parentHash":"0x0000000000000000000000000000000000000000000000000000000000000000"}' > /eth/genesis.json
        echo '["enode://70b8b0951234c8d69b416303f8850bb040549b6f07565c27794857798324b5998eae0f037f6b21e49e074f838d751fb5e8471bcf5077e183314f4adbad7952c8@172.16.239.10:30303?discport=0","enode://b48c9d6c0b9b12ceb75fc2e62824c1b00599f0be3abc7afeafa602243aaa8a847703fd580086328bde7b2fbf8082cd16922b6986fa0bfedba5006e852e43d2c7@172.16.239.11:30303?discport=0","enode://257a1ac567e898047098c1c1bca493564a13190718230dcbbab83f9e99328ec634faba31a38e71399a192c4edcbc04bb0b5061be2ebb033c3b81423561edd2e6@172.16.239.12:30303?discport=0","enode://d4adb0ef6a859be9f51a3f401a39dcdcf439c8d109f6ddb05e4bc5c2b50799f36bcfb7770f20804862c47d3d7c50f7b5488d21cb1b69ef92f834756ddbedaa84@172.16.239.13:30303?discport=0"]' > /eth/geth/static-nodes.json
        geth --datadir "/eth" --nousb init "/eth/genesis.json"
        geth \
        --identity "validator-0" \
        --rpc \
        --rpcaddr 0.0.0.0 \
        --rpcport 8545 \
        --rpccorsdomain "*" \
        --datadir /eth \
        --port 30303 \
        --rpcapi admin,debug,miner,txpool,db,eth,net,web3,istanbul,personal \
        --rpcvhosts "*" \
        --networkid 1500002 \
        --nat any \
        --nodekeyhex 28c9146d596f120a0a0ba45f5b983c366e1d8bbb988682b2d4fb2502c8d51a05 \
        --mine \
        --syncmode full \
        --miner.gasprice 0 \
        --verbosity 2 \
        --nodiscover \
        --allow-insecure-unlock \
        --nousb \
        --ethstats "validator-0:bb98a0b6442386d0cdf8a31b267892c1@172.16.239.9:3000"
    networks:
      app_net:
        ipv4_address: 172.16.239.10
    restart: always
  validator-1:
    hostname: validator-1
    image: 257258793156.dkr.ecr.ap-northeast-1.amazonaws.com/quorum:v2.7.0_validator_20200904
    ports:
      - '30304:30303'
      - '8546:8545'
    environment:
      - PRIVATE_CONFIG=ignore
    entrypoint:
      - /bin/sh
      - -c
      - |
        mkdir -p /eth/geth
        echo '{"config":{"chainId":1500002,"homesteadBlock":1,"eip150Block":2,"eip150Hash":"0x0000000000000000000000000000000000000000000000000000000000000000","eip155Block":3,"eip158Block":3,"byzantiumBlock":3,"istanbul":{"epoch":30000,"policy":0},"isQuorum":true},"nonce":"0x0","timestamp":"0x5b30a79f","extraData":"0x0000000000000000000000000000000000000000000000000000000000000000f89af8549455718e72e048375d824233e8139a7df791c9922c949dd59c486f1a307c92946ad373f28f10b1d3623294301c2945de770f93700d0b4371d59d1a81d2fdf5943a8b94e5774baa7f9b6c9ef28859dc8fd7577c5bb8410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0","gasLimit":"0x2faf0800","difficulty":"0x1","mixHash":"0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365","coinbase":"0x0000000000000000000000000000000000000000","constantinopleBlock":0,"petersburgBlock":0,"istanbulBlock":0,"alloc":{"585805c23915d6feae27fb33c6c120833ff11a72":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"},"622a8cde6464cf35de07a12963123224f28e909f":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"},"67edbafd6b3edd79cac703a383e9de80c2f92d32":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"},"95b36d653a9adb4056e72d2a0c95904690720675":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"}},"number":"0x0","gasUsed":"0x0","parentHash":"0x0000000000000000000000000000000000000000000000000000000000000000"}' > /eth/genesis.json
        echo '["enode://70b8b0951234c8d69b416303f8850bb040549b6f07565c27794857798324b5998eae0f037f6b21e49e074f838d751fb5e8471bcf5077e183314f4adbad7952c8@172.16.239.10:30303?discport=0","enode://b48c9d6c0b9b12ceb75fc2e62824c1b00599f0be3abc7afeafa602243aaa8a847703fd580086328bde7b2fbf8082cd16922b6986fa0bfedba5006e852e43d2c7@172.16.239.11:30303?discport=0","enode://257a1ac567e898047098c1c1bca493564a13190718230dcbbab83f9e99328ec634faba31a38e71399a192c4edcbc04bb0b5061be2ebb033c3b81423561edd2e6@172.16.239.12:30303?discport=0","enode://d4adb0ef6a859be9f51a3f401a39dcdcf439c8d109f6ddb05e4bc5c2b50799f36bcfb7770f20804862c47d3d7c50f7b5488d21cb1b69ef92f834756ddbedaa84@172.16.239.13:30303?discport=0"]' > /eth/geth/static-nodes.json
        geth --datadir "/eth" --nousb init "/eth/genesis.json"
        geth \
        --identity "validator-1" \
        --rpc \
        --rpcaddr 0.0.0.0 \
        --rpcport 8545 \
        --rpccorsdomain "*" \
        --datadir /eth \
        --port 30303 \
        --rpcapi admin,debug,miner,txpool,db,eth,net,web3,istanbul,personal \
        --rpcvhosts "*" \
        --networkid 1500002 \
        --nat any \
        --nodekeyhex 2034e828fcdf7453b6e047ee652973a605d473685ab50c6e2c944dd01af7dc01 \
        --mine \
        --syncmode full \
        --miner.gasprice 0 \
        --verbosity 2 \
        --nodiscover \
        --allow-insecure-unlock \
        --nousb \
        --ethstats "validator-1:bb98a0b6442386d0cdf8a31b267892c1@172.16.239.9:3000"
    networks:
      app_net:
        ipv4_address: 172.16.239.11
    restart: always
  validator-2:
    hostname: validator-2
    image: 257258793156.dkr.ecr.ap-northeast-1.amazonaws.com/quorum:v2.7.0_validator_20200904
    ports:
      - '30305:30303'
      - '8547:8545'
    environment:
      - PRIVATE_CONFIG=ignore
    entrypoint:
      - /bin/sh
      - -c
      - |
        mkdir -p /eth/geth
        echo '{"config":{"chainId":1500002,"homesteadBlock":1,"eip150Block":2,"eip150Hash":"0x0000000000000000000000000000000000000000000000000000000000000000","eip155Block":3,"eip158Block":3,"byzantiumBlock":3,"istanbul":{"epoch":30000,"policy":0},"isQuorum":true},"nonce":"0x0","timestamp":"0x5b30a79f","extraData":"0x0000000000000000000000000000000000000000000000000000000000000000f89af8549455718e72e048375d824233e8139a7df791c9922c949dd59c486f1a307c92946ad373f28f10b1d3623294301c2945de770f93700d0b4371d59d1a81d2fdf5943a8b94e5774baa7f9b6c9ef28859dc8fd7577c5bb8410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0","gasLimit":"0x2faf0800","difficulty":"0x1","mixHash":"0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365","coinbase":"0x0000000000000000000000000000000000000000","constantinopleBlock":0,"petersburgBlock":0,"istanbulBlock":0,"alloc":{"585805c23915d6feae27fb33c6c120833ff11a72":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"},"622a8cde6464cf35de07a12963123224f28e909f":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"},"67edbafd6b3edd79cac703a383e9de80c2f92d32":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"},"95b36d653a9adb4056e72d2a0c95904690720675":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"}},"number":"0x0","gasUsed":"0x0","parentHash":"0x0000000000000000000000000000000000000000000000000000000000000000"}' > /eth/genesis.json
        echo '["enode://70b8b0951234c8d69b416303f8850bb040549b6f07565c27794857798324b5998eae0f037f6b21e49e074f838d751fb5e8471bcf5077e183314f4adbad7952c8@172.16.239.10:30303?discport=0","enode://b48c9d6c0b9b12ceb75fc2e62824c1b00599f0be3abc7afeafa602243aaa8a847703fd580086328bde7b2fbf8082cd16922b6986fa0bfedba5006e852e43d2c7@172.16.239.11:30303?discport=0","enode://257a1ac567e898047098c1c1bca493564a13190718230dcbbab83f9e99328ec634faba31a38e71399a192c4edcbc04bb0b5061be2ebb033c3b81423561edd2e6@172.16.239.12:30303?discport=0","enode://d4adb0ef6a859be9f51a3f401a39dcdcf439c8d109f6ddb05e4bc5c2b50799f36bcfb7770f20804862c47d3d7c50f7b5488d21cb1b69ef92f834756ddbedaa84@172.16.239.13:30303?discport=0"]' > /eth/geth/static-nodes.json
        geth --datadir "/eth" --nousb init "/eth/genesis.json"
        geth \
        --identity "validator-2" \
        --rpc \
        --rpcaddr 0.0.0.0 \
        --rpcport 8545 \
        --rpccorsdomain "*" \
        --datadir /eth \
        --port 30303 \
        --rpcapi admin,debug,miner,txpool,db,eth,net,web3,istanbul,personal \
        --rpcvhosts "*" \
        --networkid 1500002 \
        --nat any \
        --nodekeyhex cde619902685e81ba3483bd2e669b97693982501d0057673545b460e9e356690 \
        --mine \
        --syncmode full \
        --miner.gasprice 0 \
        --verbosity 2 \
        --nodiscover \
        --allow-insecure-unlock \
        --nousb \
        --ethstats "validator-2:bb98a0b6442386d0cdf8a31b267892c1@172.16.239.9:3000"
    networks:
      app_net:
        ipv4_address: 172.16.239.12
    restart: always
  validator-3:
    hostname: validator-3
    image: 257258793156.dkr.ecr.ap-northeast-1.amazonaws.com/quorum:v2.7.0_validator_20200904
    ports:
      - '30306:30303'
      - '8548:8545'
    environment:
      - PRIVATE_CONFIG=ignore
    entrypoint:
      - /bin/sh
      - -c
      - |
        mkdir -p /eth/geth
        echo '{"config":{"chainId":1500002,"homesteadBlock":1,"eip150Block":2,"eip150Hash":"0x0000000000000000000000000000000000000000000000000000000000000000","eip155Block":3,"eip158Block":3,"byzantiumBlock":3,"istanbul":{"epoch":30000,"policy":0},"isQuorum":true},"nonce":"0x0","timestamp":"0x5b30a79f","extraData":"0x0000000000000000000000000000000000000000000000000000000000000000f89af8549455718e72e048375d824233e8139a7df791c9922c949dd59c486f1a307c92946ad373f28f10b1d3623294301c2945de770f93700d0b4371d59d1a81d2fdf5943a8b94e5774baa7f9b6c9ef28859dc8fd7577c5bb8410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0","gasLimit":"0x2faf0800","difficulty":"0x1","mixHash":"0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365","coinbase":"0x0000000000000000000000000000000000000000","constantinopleBlock":0,"petersburgBlock":0,"istanbulBlock":0,"alloc":{"585805c23915d6feae27fb33c6c120833ff11a72":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"},"622a8cde6464cf35de07a12963123224f28e909f":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"},"67edbafd6b3edd79cac703a383e9de80c2f92d32":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"},"95b36d653a9adb4056e72d2a0c95904690720675":{"balance":"0x446c3b15f9926687d2c40534fdb564000000000000"}},"number":"0x0","gasUsed":"0x0","parentHash":"0x0000000000000000000000000000000000000000000000000000000000000000"}' > /eth/genesis.json
        echo '["enode://70b8b0951234c8d69b416303f8850bb040549b6f07565c27794857798324b5998eae0f037f6b21e49e074f838d751fb5e8471bcf5077e183314f4adbad7952c8@172.16.239.10:30303?discport=0","enode://b48c9d6c0b9b12ceb75fc2e62824c1b00599f0be3abc7afeafa602243aaa8a847703fd580086328bde7b2fbf8082cd16922b6986fa0bfedba5006e852e43d2c7@172.16.239.11:30303?discport=0","enode://257a1ac567e898047098c1c1bca493564a13190718230dcbbab83f9e99328ec634faba31a38e71399a192c4edcbc04bb0b5061be2ebb033c3b81423561edd2e6@172.16.239.12:30303?discport=0","enode://d4adb0ef6a859be9f51a3f401a39dcdcf439c8d109f6ddb05e4bc5c2b50799f36bcfb7770f20804862c47d3d7c50f7b5488d21cb1b69ef92f834756ddbedaa84@172.16.239.13:30303?discport=0"]' > /eth/geth/static-nodes.json
        geth --datadir "/eth" --nousb init "/eth/genesis.json"
        geth \
        --identity "validator-3" \
        --rpc \
        --rpcaddr 0.0.0.0 \
        --rpcport 8545 \
        --rpccorsdomain "*" \
        --datadir /eth \
        --port 30303 \
        --rpcapi admin,debug,miner,txpool,db,eth,net,web3,istanbul,personal \
        --rpcvhosts "*" \
        --networkid 1500002 \
        --nat any \
        --nodekeyhex 81d7029fdd57bc940744841c29abc2513f122ad2a40c5f727e4e1aa12aa9f3e8 \
        --mine \
        --syncmode full \
        --miner.gasprice 0 \
        --verbosity 2 \
        --nodiscover \
        --allow-insecure-unlock \
        --nousb \
        --ethstats "validator-3:bb98a0b6442386d0cdf8a31b267892c1@172.16.239.9:3000"
    networks:
      app_net:
        ipv4_address: 172.16.239.13
    restart: always
networks:
  app_net:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.16.239.0/24
